<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../polymer/lib/utils/render-status.html">
<link rel="import" href="../polymer/lib/utils/flattened-nodes-observer.html">
<link rel="import" href="survey-radiogroup.html">
<link rel="import" href="survey-radio-button.html">

<dom-module id="survey-radiogroup">
  <template>
    <style>
      :host {
        display: block;
        font: inherit;
      }

      .title {
        font-family: Roboto;
        font-size: 20px;
      }

      .line {
        height: 3.5em;
        margin: 0 16px;
        display: flex;
        align-items: center;
        padding: 0;
      }

      paper-radio-group {
        display: block;
      }

    </style>

    <div class="title">[[title]]</div>
      <slot id="slot"></slot>
  </template>

  <script>
    /**
     * \<survey-radiogroup\>
     *
     * @summary ShortDescription.
     * @customElement
     * @polymer
     * @extends {Polymer.Element}
     * @demo /demo/survey-radiogroup.html
     */
    class SurveyRadioGroup extends Polymer.Element {
      /**
       * String providing the tag name to register the element under.
       */
      static get is() {
        return 'survey-radiogroup'
      }

      /**
       * Object describing property-related metadata used by Polymer features
       */
      static get properties() {
        return {
          selected: {
            type: String,
            notify: true,
            reflectToAttribute: true,
            observer: '_selectedChanged',
          },
        }
      }

      connectedCallback() {
        super.connectedCallback()
        Polymer.RenderStatus.afterNextRender(this, () => {
          this.addEventListener('click', this._clickDetect)
          this._observer = new Polymer.FlattenedNodesObserver(this.$.slot, (info) => {
            this._selectedChanged()
          })
        })
      }

      _selectedChanged(newValue) {
        const radios = Array.from(this.querySelectorAll('survey-radio-button'))
        radios.forEach(radio => radio.checked = (radio.name === this.selected))
      }

      _clickDetect(evt) {
        const target = evt.target
        this.selected = target.name
        // ensure that the selected target is checked
        target.checked = true
      }
    }

    window.customElements.define(SurveyRadioGroup.is, SurveyRadioGroup)
  </script>
</dom-module>
